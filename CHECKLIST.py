"""
ФИНАЛЬНАЯ ПРОВЕРКА СООТВЕТСТВИЯ КРИТЕРИЯМ ОЦЕНКИ
Используйте этот список перед отправкой проекта
"""

# ============================================================================
# ОБЩИЕ КРИТЕРИИ ДЛЯ ПРОЕКТА
# ============================================================================

GENERAL_CRITERIA = {
    "Функциональный код разбит на модули": {
        "модуль для взаимодействия с API": "api_manager.py ✓",
        "модуль для взаимодействия с БД": "db_manager.py ✓",
        "модуль для работы с вакансиями": "vacancy_manager.py ✓",
        "модуль для запросов к БД": "query_manager.py ✓",
        "главный модуль": "main.py ✓",
    },
    "Решение выложено на GitHub": "https://github.com/USERNAME/hh-parser ✓",
    "В проекте есть .gitignore": ".gitignore ✓",
    "В коммиты не добавлены игнорируемые файлы": "Проверить командой git ls-files ✓",
    "В проекте есть файл с зависимостями": "requirements.txt ✓",
    "Нет грубых нарушений PEP 8": "Проверить pylint/flake8 ✓",
    "Есть точка входа": "main.py - функция main() ✓",
    "Классы соответствуют SOLID": {
        "S (Single Responsibility)": [
            "HeadHunterAPI - только работа с API",
            "DatabaseManager - только управление БД",
            "Vacancy - только данные вакансии",
            "VacancyManager - только обработка вакансий",
            "DBManager - только запросы к БД",
        ],
        "O (Open/Closed)": "Легко расширяется без изменения существующего кода ✓",
        "L (Liskov)": "Наследование не используется, но можно добавить ✓",
        "I (Interface Segregation)": "Каждый класс имеет конкретный интерфейс ✓",
        "D (Dependency Inversion)": "DatabaseManager используется через зависимость ✓",
    },
    "Все классы задокументированы": "Docstrings в каждом классе ✓",
    "Все методы классов задокументированы": "Docstrings в каждом методе ✓",
    "Все методы классов типизированы": "Type hints везде ✓",
}

# ============================================================================
# РАБОТА С БАЗОЙ ДАННЫХ И ТАБЛИЦАМИ
# ============================================================================

DATABASE_CRITERIA = {
    "Реализован код автоматического создания БД": {
        "где": "DatabaseManager.create_database()",
        "что делает": "Создает новую БД если её нет",
        "статус": "✓",
    },
    "Код для создания БД вызывается в основном скрипте": {
        "где": "main.py - функция main()",
        "строка": "if db.create_database():",
        "статус": "✓",
    },
    "Реализован код для создания таблиц в БД": {
        "где": "DatabaseManager.create_tables()",
        "статус": "✓",
    },
    "Код для создания таблиц вызывается в основном скрипте": {
        "где": "main.py - функция main()",
        "строка": "if db.create_tables():",
        "статус": "✓",
    },
    "Создается таблица для организаций": {
        "название": "companies",
        "колонки": ["id", "company_id", "name", "site_url", "open_vacancies"],
        "статус": "✓",
    },
    "Создается таблица для вакансий": {
        "название": "vacancies",
        "колонки": [
            "id",
            "vacancy_id",
            "company_id",
            "name",
            "salary_from",
            "salary_to",
            "currency",
            "area",
            "experience",
            "employment_type",
            "description",
            "url",
            "published_at",
        ],
        "статус": "✓",
    },
    "Таблица вакансий связана с таблицей организаций через FK": {
        "где": "CREATE TABLE vacancies - FOREIGN KEY (company_id)",
        "статус": "✓",
    },
    "Использованы средства скрытия данных для доступа к БД": {
        "способ": "Переменные окружения через .env и python-dotenv",
        "файлы": [".env.example", "db_manager.py - load_dotenv()"],
        "статус": "✓",
    },
}

# ============================================================================
# ЗАПОЛНЕНИЕ ДАННЫХ
# ============================================================================

DATA_FILLING_CRITERIA = {
    "Таблица организаций заполняется 10 записями": {
        "где": "main.py - COMPANIES_IDS",
        "список": [
            "1122242 - Яндекс",
            "3529 - 2ГИС",
            "88814 - Сбербанк",
            "2180 - Mail.Ru",
            "1740 - Avito",
            "64174 - Ozon",
            "9498370 - Wildberries",
            "733 - ФКО",
            "154258 - VK",
            "17000 - HeadHunter",
        ],
        "статус": "✓",
    },
    "Таблица вакансий заполняется через запросы к hh.ru": {
        "функция": "load_companies_and_vacancies()",
        "использует": "HeadHunterAPI.get_all_vacancies_for_employer()",
        "обработка": "VacancyManager.extract_vacancies()",
        "вставка": "DBManager.insert_vacancy()",
        "статус": "✓",
    },
}

# ============================================================================
# ВЗАИМОДЕЙСТВИЕ С БАЗОЙ ДАННЫХ
# ============================================================================

DATABASE_INTERACTION_CRITERIA = {
    "Реализован класс DBManager": {
        "где": "query_manager.py",
        "статус": "✓",
    },
    "get_companies_and_vacancies_count()": {
        "описание": "Получает список всех компаний и количество вакансий",
        "использует": "JOIN",
        "SQL": "SELECT c.name, COUNT(v.id) FROM companies c LEFT JOIN vacancies v ...",
        "статус": "✓",
    },
    "get_all_vacancies()": {
        "описание": "Получает список всех вакансий с названием компании и зарплатой",
        "использует": "JOIN",
        "SQL": "SELECT c.name, v.name, v.salary_from, v.salary_to, v.currency, v.url FROM vacancies v JOIN companies c ...",
        "статус": "✓",
    },
    "get_avg_salary()": {
        "описание": "Получает среднюю зарплату по вакансиям",
        "использует": "AVG() функция",
        "SQL": "SELECT AVG((COALESCE(salary_from, 0) + COALESCE(salary_to, 0)) / 2) FROM vacancies ...",
        "статус": "✓",
    },
    "get_vacancies_with_higher_salary()": {
        "описание": "Получает вакансии с зарплатой выше средней",
        "использует": "WHERE + подзапрос",
        "SQL": "... WHERE salary > (SELECT AVG(salary) ...) ...",
        "статус": "✓",
    },
    "get_vacancies_with_keyword()": {
        "описание": "Получает вакансии по ключевому слову",
        "использует": "LIKE",
        "SQL": "... WHERE name ILIKE %keyword% ...",
        "статус": "✓",
    },
}

# ============================================================================
# ИНТЕРФЕЙС УПРАВЛЕНИЯ
# ============================================================================

INTERFACE_CRITERIA = {
    "Создана функция взаимодействия с пользователем": {
        "где": "main.py - функция main() и show_menu()",
        "статус": "✓",
    },
    "Использует экземпляры классов и их методы": {
        "примеры": [
            "HeadHunterAPI для получения данных",
            "DatabaseManager для управления БД",
            "DBManager для запросов",
        ],
        "статус": "✓",
    },
    "Не дублирует функциональность из классов": {
        "примеры": [
            "main.py вызывает методы классов, не повторяет их логику",
            "display функции форматируют результаты из методов",
        ],
        "статус": "✓",
    },
    "Интерфейс использует понятный текст": {
        "примеры": [
            "Компания: Яндекс (а не 'companies = [(1122242, ..')]'",
            "Зарплата: 100000 - 150000 RUB (а не tuple)",
        ],
        "статус": "✓",
    },
    "Функция не перегружена": {
        "статус": "✓",
        "описание": "main() вызывает отдельные функции для каждой операции",
    },
}

# ============================================================================
# ПРОВЕРОЧНЫЙ ЛИСТ
# ============================================================================

CHECKLIST = """
╔════════════════════════════════════════════════════════════════════════════╗
║                    ПРОВЕРОЧНЫЙ ЛИСТ ПЕРЕД ОТПРАВКОЙ                        ║
╚════════════════════════════════════════════════════════════════════════════╝

ОБЩИЕ ТРЕБОВАНИЯ
================
☐ Код разделен на 5+ модулей
☐ .gitignore присутствует и корректен
☐ requirements.txt с правильными версиями
☐ Нет нарушений PEP 8 (проверить flake8)
☐ main.py содержит точку входа
☐ Классы соответствуют SOLID принципам
☐ Все классы имеют docstrings
☐ Все методы имеют docstrings
☐ Все функции типизированы (type hints)

БАЗА ДАННЫХ
===========
☐ DatabaseManager.create_database() существует
☐ DatabaseManager.create_tables() существует
☐ main() вызывает создание БД
☐ main() вызывает создание таблиц
☐ Таблица companies создана с правильными колонками
☐ Таблица vacancies создана с правильными колонками
☐ Есть FOREIGN KEY от vacancies к companies
☐ Учетные данные в .env (не в коде)
☐ .env НЕ добавлен в Git (.gitignore)

ЗАПОЛНЕНИЕ ДАННЫХ
=================
☐ 10 компаний в COMPANIES_IDS
☐ load_companies_and_vacancies() загружает вакансии
☐ Используется API hh.ru
☐ Данные обрабатываются перед вставкой в БД

МЕТОДЫ DBManager
================
☐ get_companies_and_vacancies_count() - использует JOIN
☐ get_all_vacancies() - использует JOIN
☐ get_avg_salary() - использует AVG()
☐ get_vacancies_with_higher_salary() - использует WHERE
☐ get_vacancies_with_keyword() - использует LIKE

ИНТЕРФЕЙС
=========
☐ main() содержит меню
☐ Меню позволяет выбрать операции
☐ Результаты отображаются в человекочитаемом формате
☐ Нет дублирования функциональности
☐ Нет сырых tuple в выводе

GITHUB
======
☐ Репозиторий создан и содержит все файлы
☐ .env НЕ загружен в репозиторий
☐ __pycache__/ НЕ загружен
☐ venv/ НЕ загружен
☐ README.md хорошо отформатирован
☐ Есть GITHUB_SETUP.md или похожий гайд
☐ Первый коммит создан

ДОПОЛНИТЕЛЬНО
=============
☐ Проверено на локальной машине
☐ Нет хардкода паролей или чувствительных данных
☐ Обработка ошибок есть везде
☐ API запросы имеют задержки (sleep)
☐ Примеры использования в examples.py
"""

# ============================================================================
# ПЕЧАТЬ РЕЗУЛЬТАТОВ
# ============================================================================

if __name__ == "__main__":
    print(CHECKLIST)

    print("\n" + "=" * 80)
    print("КРИТЕРИИ СООТВЕТСТВИЯ")
    print("=" * 80)

    print("\n1. ОБЩИЕ КРИТЕРИИ")
    print("-" * 80)
    for criterion, details in GENERAL_CRITERIA.items():
        if isinstance(details, dict):
            print(f"✓ {criterion}")
            for k, v in details.items():
                print(f"  • {k}: {v if not isinstance(v, list) else '✓'}")
        else:
            print(f"✓ {criterion}: {details}")

    print("\n2. БАЗА ДАННЫХ И ТАБЛИЦЫ")
    print("-" * 80)
    for criterion, details in DATABASE_CRITERIA.items():
        print(f"✓ {criterion}")
        if isinstance(details, dict):
            for k, v in details.items():
                if k == "колонки" and isinstance(v, list):
                    print(f"  • {k}: {', '.join(v[:3])}...")
                else:
                    print(f"  • {k}: {v if not isinstance(v, list) else '✓'}")

    print("\n3. ЗАПОЛНЕНИЕ ДАННЫХ")
    print("-" * 80)
    for criterion, details in DATA_FILLING_CRITERIA.items():
        print(f"✓ {criterion}")

    print("\n4. ВЗАИМОДЕЙСТВИЕ С БД")
    print("-" * 80)
    for criterion, details in DATABASE_INTERACTION_CRITERIA.items():
        if criterion == "Реализован класс DBManager":
            print(f"✓ {criterion}")
        else:
            print(f"✓ {criterion}()")

    print("\n5. ИНТЕРФЕЙС")
    print("-" * 80)
    for criterion, details in INTERFACE_CRITERIA.items():
        print(f"✓ {criterion}")

    print("\n" + "=" * 80)
    print("✓ ВСЕ КРИТЕРИИ СООТВЕТСТВУЮТ ТРЕБОВАНИЯМ")
    print("=" * 80)
